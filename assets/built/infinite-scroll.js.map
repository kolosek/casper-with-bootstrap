{"version":3,"file":"infinite-scroll.js","sources":["infinite-scroll.js"],"sourcesContent":["/* eslint-env browser */\n\n/**\n * Infinite Scroll\n * Used on all pages where there is a list of posts (homepage, tag index, etc).\n *\n * When the page is scrolled to 300px from the bottom, the next page of posts\n * is fetched by following the the <link rel=\"next\" href=\"...\"> that is output\n * by {{ghost_head}}.\n *\n * The individual post items are extracted from the fetched pages by looking for\n * a wrapper element with the class \"post-card\". Any found elements are appended\n * to the element with the class \"post-feed\" in the currently viewed page.\n */\n\n(function (window, document) {\n    if (document.documentElement.classList.contains('no-infinite-scroll')) return;\n\n    // next link element\n    var nextElement = document.querySelector('link[rel=next]');\n    if (!nextElement) {\n        return;\n    }\n\n    // post feed element\n    var feedElement = document.querySelector('.post-feed');\n    if (!feedElement) {\n        return;\n    }\n\n    var buffer = 300;\n\n    var ticking = false;\n    var loading = false;\n\n    var lastScrollY = window.scrollY;\n    var lastWindowHeight = window.innerHeight;\n    var lastDocumentHeight = document.documentElement.scrollHeight;\n\n    function onPageLoad() {\n        if (this.status === 404) {\n            window.removeEventListener('scroll', onScroll);\n            window.removeEventListener('resize', onResize);\n            return;\n        }\n\n        // append contents\n        var postElements = this.response.querySelectorAll('article.post-card');\n        postElements.forEach(function (item) {\n            // document.importNode is important, without it the item's owner\n            // document will be different which can break resizing of\n            // `object-fit: cover` images in Safari\n            feedElement.appendChild(document.importNode(item, true));\n        });\n\n        // set next link\n        var resNextElement = this.response.querySelector('link[rel=next]');\n        if (resNextElement) {\n            nextElement.href = resNextElement.href;\n        } else {\n            window.removeEventListener('scroll', onScroll);\n            window.removeEventListener('resize', onResize);\n        }\n\n        // sync status\n        lastDocumentHeight = document.documentElement.scrollHeight;\n        ticking = false;\n        loading = false;\n    }\n\n    function onUpdate() {\n        // return if already loading\n        if (loading) {\n            return;\n        }\n\n        // return if not scroll to the bottom\n        if (lastScrollY + lastWindowHeight <= lastDocumentHeight - buffer) {\n            ticking = false;\n            return;\n        }\n\n        loading = true;\n\n        var xhr = new window.XMLHttpRequest();\n        xhr.responseType = 'document';\n\n        xhr.addEventListener('load', onPageLoad);\n\n        xhr.open('GET', nextElement.href);\n        xhr.send(null);\n    }\n\n    function requestTick() {\n        ticking || window.requestAnimationFrame(onUpdate);\n        ticking = true;\n    }\n\n    function onScroll() {\n        lastScrollY = window.scrollY;\n        requestTick();\n    }\n\n    function onResize() {\n        lastWindowHeight = window.innerHeight;\n        lastDocumentHeight = document.documentElement.scrollHeight;\n        requestTick();\n    }\n\n    window.addEventListener('scroll', onScroll, {passive: true});\n    window.addEventListener('resize', onResize);\n\n    requestTick();\n})(window, document);\n"],"names":["window","document","nextElement","feedElement","buffer","ticking","loading","lastScrollY","lastWindowHeight","lastDocumentHeight","onPageLoad","this","status","removeEventListener","onScroll","onResize","response","querySelectorAll","forEach","item","appendChild","importNode","resNextElement","querySelector","href","documentElement","scrollHeight","onUpdate","xhr","XMLHttpRequest","responseType","addEventListener","open","send","requestTick","requestAnimationFrame","scrollY","innerHeight","classList","contains","passive"],"mappings":"CAeA,SAAWA,EAAQC,GACf,IAGIC,EAMAC,EAKAC,EAEAC,EACAC,EAEAC,EACAC,EACAC,EAEJ,SAASC,IACL,GAAoB,MAAhBC,KAAKC,OAGL,OAFAZ,EAAOa,oBAAoB,SAAUC,QACrCd,EAAOa,oBAAoB,SAAUE,GAKtBJ,KAAKK,SAASC,iBAAiB,qBACrCC,QAAQ,SAAUC,GAI3BhB,EAAYiB,YAAYnB,EAASoB,WAAWF,GAAM,MAItD,IAAIG,EAAiBX,KAAKK,SAASO,cAAc,kBAC7CD,EACApB,EAAYsB,KAAOF,EAAeE,MAElCxB,EAAOa,oBAAoB,SAAUC,GACrCd,EAAOa,oBAAoB,SAAUE,IAIzCN,EAAqBR,EAASwB,gBAAgBC,aAE9CpB,EADAD,GAAU,EAId,SAASsB,IAEL,IAYIC,EAZAtB,IAKAC,EAAcC,GAAoBC,EAAqBL,EACvDC,GAAU,GAIdC,GAAU,GAENsB,EAAM,IAAI5B,EAAO6B,gBACjBC,aAAe,WAEnBF,EAAIG,iBAAiB,OAAQrB,GAE7BkB,EAAII,KAAK,MAAO9B,EAAYsB,MAC5BI,EAAIK,KAAK,QAGb,SAASC,IACL7B,GAAWL,EAAOmC,sBAAsBR,GACxCtB,GAAU,EAGd,SAASS,IACLP,EAAcP,EAAOoC,QACrBF,IAGJ,SAASnB,IACLP,EAAmBR,EAAOqC,YAC1B5B,EAAqBR,EAASwB,gBAAgBC,aAC9CQ,IA1FAjC,EAASwB,gBAAgBa,UAAUC,SAAS,0BAG5CrC,EAAcD,EAASsB,cAAc,qBAMrCpB,EAAcF,EAASsB,cAAc,iBAQrCjB,EADAD,IAFAD,EAAS,KAKTG,EAAcP,EAAOoC,QACrB5B,EAAmBR,EAAOqC,YAC1B5B,EAAqBR,EAASwB,gBAAgBC,aAwElD1B,EAAO+B,iBAAiB,SAAUjB,EAAU,CAAC0B,SAAS,IACtDxC,EAAO+B,iBAAiB,SAAUhB,GAElCmB,MAjGJ,CAkGGlC,OAAQC"}